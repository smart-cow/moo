// Generated by CoffeeScript 1.7.1
(function() {
  angular.module("moo.start-workflow.controllers", []).controller("StartWorkflowCtrl", [
    "$scope", "$location", "$compile", "Workflows", "RunningWorkflows", function($scope, $location, $compile, Workflows, RunningWorkflows) {
      var hideSuccessModal, hideVariablesModal, loadedWorkflows, showSuccessModal, showVariablesModal;
      $scope.workflows = Workflows.query();
      $scope.selectedWorkflow = null;
      $scope.wflowVars = {};
      showVariablesModal = function() {
        return $("#variables-modal").modal("show");
      };
      hideVariablesModal = function() {
        return $("#variables-modal").modal("hide");
      };
      showSuccessModal = function() {
        return $("#success-modal").modal("show");
      };
      hideSuccessModal = function(callBack) {
        console.log("hide");
        if (callBack != null) {
          $("#success-modal").on("hidden.bs.modal", callBack);
        }
        $("#success-modal").modal("hide");
        return true;
      };
      $scope.selectWorkflow = function(wfName) {
        $scope.selectedWorkflow = wfName;
        if ($scope.wflowVars[wfName] != null) {
          showVariablesModal();
        } else {
          Workflows.get(wfName, function(workflow) {
            $scope.wflowVars[wfName] = workflow.variables;
            return showVariablesModal();
          });
        }
        return null;
      };
      $scope.selectedWflowVariables = function() {
        return $scope.wflowVars[$scope.selectedWorkflow];
      };
      $scope.viewProgress = function() {
        return hideSuccessModal(function() {
          return $scope.$apply(function() {
            return $location.path("/active-workflows/" + $scope.selectedWorkflow);
          });
        });
      };
      loadedWorkflows = {};
      $scope.loadWorkflowTree = function(wfName) {
        var newTree;
        if (loadedWorkflows[wfName] != null) {
          return true;
        }
        loadedWorkflows[wfName] = true;
        $scope.wfName = wfName;
        newTree = $compile("<moo-workflow-tree wflow-name='wfName' editable='false'></moo-workflow-tree>")($scope);
        $("#hidden-row-" + wfName).append(newTree);
        return true;
      };
      return $scope.startWorkflow = function() {
        var onFailure, onSuccess, variables, wflowName;
        wflowName = $scope.selectedWorkflow;
        variables = $scope.wflowVars[wflowName];
        onSuccess = function(data) {
          $scope.workflowInstanceId = data.key;
          hideVariablesModal();
          return showSuccessModal();
        };
        onFailure = function() {
          return alert("Error: " + wflowName + " has NOT been started");
        };
        return RunningWorkflows.start(wflowName, variables, onSuccess, onFailure);
      };
    }
  ]);

}).call(this);

//# sourceMappingURL=start-workflow.map
