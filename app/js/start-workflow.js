// Generated by CoffeeScript 1.7.1
(function() {
  angular.module("moo.start-workflow.controllers", []).controller("StartWorkflowCtrl", [
    "$scope", "$location", "$compile", "Workflows", "RunningWorkflows", function($scope, $location, $compile, Workflows, RunningWorkflows) {
      var hideSuccessModal, hideVariablesModal, showSuccessModal, showVariablesModal;
      $scope.selectedWorkflow = null;
      $scope.wflowVars = {};
      showVariablesModal = function() {
        return $("#variables-modal").modal("show");
      };
      hideVariablesModal = function() {
        return $("#variables-modal").modal("hide");
      };
      showSuccessModal = function() {
        return $("#success-modal").modal("show");
      };
      hideSuccessModal = function(callBack) {
        console.log("hide");
        if (callBack != null) {
          $("#success-modal").on("hidden.bs.modal", callBack);
        }
        $("#success-modal").modal("hide");
        return true;
      };
      $scope.$on("moo.workflow.selected", function(evt, wfName) {
        $scope.selectedWorkflow = wfName;
        if ($scope.wflowVars[wfName] != null) {
          showVariablesModal();
        } else {
          Workflows.get(wfName, function(workflow) {
            var _ref;
            $scope.wflowVars[wfName] = (_ref = workflow.variables) != null ? _ref : [];
            return showVariablesModal();
          });
        }
        return true;
      });
      $scope.selectedWflowVariables = function() {
        return $scope.wflowVars[$scope.selectedWorkflow];
      };
      $scope.viewProgress = function() {
        return hideSuccessModal(function() {
          return $scope.$apply(function() {
            return $location.path("/workflows/active-by-type/" + $scope.selectedWorkflow);
          });
        });
      };
      $scope.startWorkflow = function() {
        var onFailure, onSuccess, variables, wflowName;
        wflowName = $scope.selectedWorkflow;
        variables = $scope.wflowVars[wflowName];
        onSuccess = function(data) {
          $scope.workflowInstanceId = data.key;
          hideVariablesModal();
          return showSuccessModal();
        };
        onFailure = function() {
          return alert("Error: " + wflowName + " has NOT been started");
        };
        return RunningWorkflows.start(wflowName, variables, onSuccess, onFailure);
      };
      return $scope.$on("modal.clicked.accept", function() {
        return $scope.startWorkflow();
      });
    }
  ]);

}).call(this);

//# sourceMappingURL=start-workflow.map
